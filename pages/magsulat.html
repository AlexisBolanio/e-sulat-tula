<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Magsulat - E-SULAT-TULA</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/landpage.css">
    <link rel="stylesheet" href="../css/nav.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/about.css">
    <style>
        .content-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap:18px; padding:18px; }
        .theme-card { background:#f7f0e6; border-radius:8px; padding:18px; min-height:120px; box-shadow:0 6px 18px rgba(0,0,0,0.06); transition: transform 0.2s, box-shadow 0.2s; }
        .theme-card:hover { transform: translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,0.1); }
        @keyframes spin { to { transform: rotate(360deg); } }
        .modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter:blur(5px); align-items:center; justify-content:center; }
        .modal-content { background:white; margin:auto; padding:28px; border-radius:14px; max-width:520px; position:relative; }
        .close-button { position:absolute; right:18px; top:12px; font-size:26px; cursor:pointer; color:#888; }
        .btn-auth { width: 100%; padding: 12px; background: #5d4037; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 8px; }
        .btn-auth-link { background: transparent; border: none; color: #5d4037; cursor: pointer; font-weight: 600; margin-right: 12px; }
        .form-error { color:#b00020; font-size:0.95rem; margin-top:8px; min-height:18px; }
        #authModal .auth-box input { width:100%; padding:12px 14px; margin:8px 0; border:1px solid #e3e3e3; border-radius:8px; font-size:0.95rem; box-sizing:border-box; }
        #authModal .auth-row { display:flex; gap:12px; }
        #authModal .auth-row .col { flex:1; }
        #authModal .auth-title { margin:0 0 8px; font-size:1.25rem; color:#333; }
        #authModal .toggle-text { margin-top:12px; font-size:0.88rem; text-align:center; }
        #authModal .toggle-text a { color:#5d4037; font-weight:600; text-decoration:none; }
    </style>
</head>
<body>
    <!-- Reuse same navbar as landing page -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="../assets/picture/new-logo-removebg-preview.png" alt="Logo">
            </div>
            <button type="button" class="nav-hamburger" id="navHamburger" aria-label="Buksan ang menu" aria-expanded="false">
                <span class="nav-hamburger-icon"><i class="fa-solid fa-bars"></i></span>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="landpage.html">Home</a></li>
                <li><a href="magsulat.html" class="active">Magsulat</a></li>
                <li id="adminNavItem" style="display:none"><a href="admin.html">Admin</a></li>
            </ul>
            <div class="user-section">
                <button type="button" class="nav-dark-toggle" id="navDarkToggle" aria-label="Dark mode" title="Palitan ang tema">
                    <i class="fa-solid fa-moon" id="navDarkIcon"></i>
                </button>
                <span class="welcome-text">Welcome, <span id="nickname">Makata</span></span>
                <div class="nav-notif-wrap" id="navNotifWrap" style="display:none">
                    <button id="navNotifBell" class="nav-notif-bell" type="button" title="Mga na-approve na talata" aria-label="Mga notipikasyon">
                        <i class="fa-solid fa-bell"></i>
                        <span id="navNotifBadge" class="nav-notif-badge hide">0</span>
                    </button>
                    <div id="navNotifDropdown" class="nav-notif-dropdown" aria-hidden="true">
                        <p class="notif-dropdown-title"><i class="fa-solid fa-check-circle"></i> Mga na-approve na talata</p>
                        <p class="notif-dropdown-msg" id="navNotifDropdownMsg"></p>
                        <button type="button" class="notif-dropdown-close" id="navNotifDropdownClose">Sara</button>
                    </div>
                </div>
                <button id="openLoginBtn" class="btn-auth-link" style="display:none">Mag-login</button>
                <!--<button id="openRegisterBtn" class="btn-auth-link">Mag-register</button>-->
                <button id="logoutBtn" class="logout-icon" style="display:none">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="page-wrap">
    <main style="padding:18px;">
        <h2 style="margin:0 0 4px">TEMA NG TULA</h2>

        <div id="themesGrid" class="content-grid" style="margin-top:16px;">
            <!-- themes from server will be rendered here -->
        </div>
    </main>

    <footer class="site-footer">
        <div class="footer-inner">
            <a href="landpage.html" class="footer-brand">
                <img src="../assets/picture/new-logo-removebg-preview.png" alt="E-SULAT-TULA">
                <span>E-SULAT-TULA</span>
            </a>
            <p class="footer-credit">
                Developed with <i class="fa-solid fa-heart" style="color:#c45c4a;"></i> by <a href="#" rel="noopener">E-SULAT-TULA Team</a>
            </p>
            <ul class="footer-links">
                <li><a href="landpage.html">Home</a></li>
                <li><a href="magsulat.html">Magsulat</a></li>
            </ul>
        </div>
    </footer>
    </div>

    <div id="globalLoader" style="display:none; position:fixed; inset:0; z-index:2000; background:rgba(0,0,0,0.35); align-items:center; justify-content:center; flex-wrap:wrap;">
        <div style="background:white; padding:18px 22px; border-radius:10px; display:flex; gap:12px; align-items:center; box-shadow:0 8px 36px rgba(0,0,0,0.18);">
            <div style="width:20px;height:20px;border-radius:50%;border:3px solid #eee;border-top-color:#5d4037;animation:spin 1s linear infinite;"></div>
            <span id="globalLoaderText">Naglo-load...</span>
        </div>
    </div>

    <!-- Auth Modal (Login / Register) -->
    <div id="authModal" class="modal">
        <div class="modal-content" style="max-width:480px;">
            <span class="close-button" id="closeModal">&times;</span>
            <div id="login-box" class="auth-box">
                <h2 class="auth-title">Login</h2>
                <form id="loginForm">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Password" required>
                    <div id="loginError" class="form-error" style="min-height:18px;"></div>
                    <button type="submit" class="btn-auth">Pumasok</button>
                </form>
                <p class="toggle-text">Wala pang account? <a href="javascript:void(0)" onclick="toggleAuth()">Mag-register</a></p>
            </div>
            <div id="register-box" class="auth-box" style="display:none;">
                <h2 class="auth-title">Register</h2>
                <form id="registerForm">
                    <div class="auth-row">
                        <div class="col"><input type="text" id="regFirst" placeholder="First Name" required></div>
                        <div class="col"><input type="text" id="regLast" placeholder="Last Name" required></div>
                    </div>
                    <input type="text" id="regName" placeholder="Nickname (display name)" required>
                    <input type="email" id="regEmail" placeholder="Email" required>
                    <input type="password" id="regPassword" placeholder="Password" required>
                    <div id="registerError" class="form-error" style="min-height:18px;"></div>
                    <button type="submit" class="btn-auth">Sumali</button>
                </form>
                <p class="toggle-text">May account na? <a href="javascript:void(0)" onclick="toggleAuth()">Mag-login</a></p>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="../script/script.js"></script>
    <script>
        // magsulat page theme loader + add
        async function loadThemes() {
            showGlobalLoader('Kukunin ang mga tema...');
            try {
                const res = await fetch(`${API_BASE}/themes`);
                const data = await res.json();
                const grid = document.getElementById('themesGrid');
                grid.innerHTML = '';
                const themes = data && data.themes ? data.themes : [];
                if (themes.length === 0) {
                    grid.innerHTML = '<div style="grid-column:1/-1;color:#666">Walang tema pa. Magdagdag ng bago.</div>';
                    return;
                }
                themes.forEach(t => {
                    const el = document.createElement('a');
                    el.className = 'theme-card';
                    el.href = `theme.html?theme_id=${t.id}`;
                    el.style.textDecoration = 'none';
                    el.style.color = 'inherit';
                    el.style.display = 'block';
                    el.innerHTML = `<strong style="display:block;margin-bottom:8px">${escapeHtml(t.title)}</strong><div style="color:#444;font-size:0.95rem">${escapeHtml(t.description || '')}</div><div style="margin-top:10px;font-size:0.85rem;color:#5d4037;"><i class="fa-solid fa-feather-pointed"></i> Tingnan at magsulat</div>`;
                    grid.appendChild(el);
                });
            } catch (err) {
                console.error(err);
                const grid = document.getElementById('themesGrid');
                grid.innerHTML = '<div style="grid-column:1/-1;color:#b00020">Hindi makuha ang mga tema.</div>';
            } finally {
                hideGlobalLoader();
            }
        }

        function escapeHtml(s) {
            return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
        }

        // load on page ready
        document.addEventListener('DOMContentLoaded', () => {
            updateAuthUI();
            const user = getLoggedInUser();
            if (user && (user.role || '').toLowerCase() === 'admin') {
                const ni = document.getElementById('adminNavItem');
                if (ni) ni.style.display = 'block';
            }
            loadThemes();
        });
    </script>
</body>
</html>
